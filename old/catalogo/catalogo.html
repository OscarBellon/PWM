<!DOCTYPE html>
<html>
    <head>
        <script src="https://www.w3schools.com/lib/w3.js"></script>
        <link rel="stylesheet" type="text/css" href="catalogo.css">
    </head>
    <body>
        <header id="header"></header>
        <main>
            <nav>
                <div id="menuToggle">
                    <input type="checkbox" />
                    <span></span>
                    <span></span>
                    <span></span>
                    <ul id="menu">
                        <li>Sección A</li>
                        <li>Sección B</li>
                        <li>Sección C</li>
                        <li>Sección D</li>
                        <li>Sección E</li>
                        <li>Sección F</li>
                    </ul>
                </div>
            </nav>

            <section id="contenedorDeProductos">
                <template id="producto">
                    <article></article>
                </template>
            </section>
            
        </main>
        <footer id="footer"></footer>
    </body>
    <script>
        document.addEventListener('DOMContentLoaded', init);

        const supportsTemplate = function () {
            //create a template element and make sure it has a 'content' property
            return 'content' in document.createElement('template');
        }

        function loadTemplate(fileName, id, callback) {

            fetch(fileName).then((res) => {
                return res.text();
            }).then((text) => {
                document.getElementById(id).innerHTML = text;
                //console.log(text)

                if(callback){
                    callback();
                }
            })
        }

        function init() {
            loadTemplate("/Componentes/Header/header.html","header");
            loadTemplate("/Componentes/footer/footer.html","footer");
            addProducts();

        }

        function addProducts(){
            fetch("/resources/productos.json")
            .then((response) => {
                return response.json();
            })
            .then((products) =>{
                if ('content' in document.createElement('template')) {
                    const container = document.getElementById('contenedorDeProductos');

                    products.forEach((product) => {

                        const tmpl = document
                            .getElementById('producto')
                            .content.cloneNode(true);
                        
                        var htmldir = "";

                        fetch("/catalogo/productoComponente.html")
                        .then((res)=>{
                            return res.text();
                        }).then((text)=>{
                            //console.log(text);
                            const tmpl = document
                                .getElementById('producto')
                                .content.cloneNode(true);

                            tmpl.querySelector('article').innerHTML= text;
                            tmpl.querySelector(".nombreProducto").innerText=product.nombre;
                            tmpl.querySelector(".precio").innerText=product.precio;
                            if (product.disponibilidad) {
                                console.log("cambio de color")
                                tmpl.querySelector(".circulo").style.background="#03738c";
                            } else {
                                tmpl.querySelector(".circulo").style.background="lightcoral";
                            }
                            container.appendChild(tmpl);
                        })
                        

                        
                        
                    });
                } else {
                    console.error('Your browser does not support templates');
                }
            })
        }
    </script>
</html>